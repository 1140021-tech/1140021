<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è§€éŸ³å»Ÿç·šä¸Šæ‹œæ‹œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Serif TC', serif;
            touch-action: manipulation;
        }
        .temple-bg {
            background-color: #581c1c;
            background-image:
                radial-gradient(circle at 50% 0, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0) 25%),
                radial-gradient(circle at 100% 50%, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0) 25%),
                radial-gradient(circle at 0 50%, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0) 25%);
        }
        .altar {
            background: #6f4e37;
            border: 4px solid #a07b5f;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5), inset 0 0 15px rgba(0,0,0,0.5);
        }
        .btn-action {
            background-color: #d4af37;
            border: 2px solid #b8860b;
            color: #4a2c2a;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }
        .btn-action:hover {
            background-color: #e6c35c;
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0,0,0,0.3);
        }
        .btn-action:disabled {
            background-color: #a9a9a9;
            border-color: #808080;
            color: #555;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .offering {
            transition: opacity 0.7s ease-in-out, transform 0.7s ease-in-out;
            opacity: 0;
            transform: translateY(20px);
        }
        .offering.visible {
            opacity: 1;
            transform: translateY(0);
        }
        #fortune-slip {
            background-color: #fffbeb;
            border: 2px solid #d4af37;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
        }
        .flicker {
            animation: flickerAnimation 2s infinite;
        }
        @keyframes flickerAnimation {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
    </style>
</head>
<body class="temple-bg min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-4xl mx-auto bg-black bg-opacity-20 rounded-2xl shadow-2xl p-4 sm:p-6 md:p-8">
        
        <!-- æ¨™é¡Œ -->
        <header class="text-center mb-4">
            <h1 class="text-3xl sm:text-4xl font-bold text-yellow-200" style="text-shadow: 2px 2px 4px #000;">è§€éŸ³å»Ÿ ç·šä¸Šç¥ˆç¦</h1>
            <p class="text-yellow-300 text-sm sm:text-base">è«‹ä»¥è™”èª çš„å¿ƒï¼Œå®Œæˆåƒæ‹œæµç¨‹</p>
        </header>

        <!-- éŠæˆ²ä¸»å ´æ™¯ -->
        <div class="flex flex-col items-center">
            <!-- è§€éŸ³åƒ -->
            <div class="relative mb-4">
                <img src="https://i.pinimg.com/564x/a0/a7/9b/a0a79b7600f135a5196238b9a19f2683.jpg" alt="Qç‰ˆè§€éŸ³åƒ" class="rounded-lg shadow-lg" style="border: 4px solid #d4af37; max-height: 450px; width: auto; object-fit: cover;">
                <!-- é¦™çˆèˆ‡é¦™ -->
                <div id="incense" class="offering absolute bottom-0 left-1/2 -translate-x-1/2 translate-y-1/2 w-24 h-20 flex flex-col items-center">
                     <div class="w-24 h-12 bg-bronze-700 flex justify-center items-end" style="background-color: #8c7853; border-radius: 5px 5px 15px 15px; border: 2px solid #5a4d3a;">
                        <div class="flex space-x-1">
                            <div class="w-0.5 h-8 bg-red-400 flicker"></div>
                            <div class="w-0.5 h-8 bg-red-400 flicker" style="animation-delay: 0.5s;"></div>
                            <div class="w-0.5 h-8 bg-red-400 flicker" style="animation-delay: 1s;"></div>
                        </div>
                    </div>
                    <div class="w-20 h-2 bg-yellow-900"></div>
                </div>
            </div>

            <!-- ç¥æ¡Œ -->
            <div class="altar w-full max-w-xl h-24 rounded-lg flex justify-center items-end p-2 gap-4">
                <div id="flowers" class="offering text-center">
                    <div class="text-5xl">ğŸ’</div>
                    <div class="text-xs text-yellow-200">é®®èŠ±</div>
                </div>
                <div id="fruits" class="offering text-center">
                    <div class="text-5xl">ğŸğŸŠ</div>
                    <div class="text-xs text-yellow-200">æ°´æœ</div>
                </div>
            </div>
        </div>

        <!-- äº’å‹•å€ -->
        <div class="mt-6 p-4 bg-black bg-opacity-30 rounded-lg">
            <!-- è¨Šæ¯é¡¯ç¤º -->
            <div id="message-board" class="min-h-[60px] text-center text-yellow-200 text-lg mb-4 flex items-center justify-center p-2 rounded-md bg-black bg-opacity-20">
                è«‹é»æ“Šã€Œä¸Šé¦™ã€é–‹å§‹æ‚¨çš„åƒæ‹œã€‚
            </div>

            <!-- ç¥ˆç¦è¼¸å…¥æ¡† -->
            <div id="prayer-section" class="hidden flex-col items-center mb-4">
                <textarea id="prayer-text" class="w-full max-w-md p-2 rounded-md bg-yellow-100 text-gray-800 focus:outline-none focus:ring-2 focus:ring-d4af37" rows="3" placeholder="è«‹åœ¨æ­¤è¼¸å…¥æ‚¨çš„ç¥ˆé¡˜..."></textarea>
                <button id="submit-prayer-btn" class="btn-action font-bold py-2 px-6 rounded-lg mt-2">é»˜å¿µç¥ˆç¦±</button>
            </div>

            <!-- æ“²ç­Šå’Œæ±‚ç±¤çµæœ -->
            <div id="result-section" class="text-center">
                <div id="jiaobei-result" class="text-2xl font-bold text-white mb-2"></div>
                <div id="fortune-slip" class="hidden p-4 rounded-lg mx-auto max-w-md mt-4">
                    <h3 id="fortune-title" class="text-2xl font-bold text-red-700 text-center mb-2"></h3>
                    <p id="fortune-text" class="text-gray-700 text-center"></p>
                    <!-- Gemini API Feature: AIè§£ç±¤ -->
                    <div id="gemini-section" class="mt-4 text-center hidden">
                        <button id="gemini-btn" class="btn-action font-bold py-2 px-6 rounded-lg">âœ¨ è«‹è§€éŸ³é–‹ç¤º</button>
                        <div id="gemini-loading" class="hidden mt-4 text-yellow-200">è§€éŸ³è©è–©æ­£åœ¨å‚¾è½æ‚¨çš„å¿ƒè²ï¼Œè«‹ç¨å€™...</div>
                        <div id="gemini-result" class="mt-4 p-3 text-left bg-white rounded-md text-gray-800" style="white-space: pre-wrap; display: none;"></div>
                    </div>
                </div>
            </div>

            <!-- æ“ä½œæŒ‰éˆ• -->
            <div id="controls" class="flex flex-wrap justify-center gap-2 sm:gap-4">
                <button id="incense-btn" class="btn-action font-bold py-2 px-4 rounded-lg">1. ä¸Šé¦™</button>
                <button id="offering-btn" class="btn-action font-bold py-2 px-4 rounded-lg" disabled>2. ç»ä¸Šä¾›å“</button>
                <button id="pray-btn" class="btn-action font-bold py-2 px-4 rounded-lg" disabled>3. èª å¿ƒç¥ˆç¦</button>
                <button id="cast-blocks-btn" class="btn-action font-bold py-2 px-4 rounded-lg" disabled>4. æ“²ç­Šå•äº‹</button>
                <button id="draw-fortune-btn" class="btn-action font-bold py-2 px-4 rounded-lg" disabled>5. æ±‚å–éˆç±¤</button>
                <button id="reset-btn" class="bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition">é‡æ–°åƒæ‹œ</button>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const messageBoard = document.getElementById('message-board');
        const incense = document.getElementById('incense');
        const fruits = document.getElementById('fruits');
        const flowers = document.getElementById('flowers');
        const prayerSection = document.getElementById('prayer-section');
        const prayerText = document.getElementById('prayer-text');
        const jiaobeiResult = document.getElementById('jiaobei-result');
        
        // Fortune and Gemini Elements
        const fortuneSlip = document.getElementById('fortune-slip');
        const fortuneTitle = document.getElementById('fortune-title');
        const fortuneText = document.getElementById('fortune-text');
        const geminiSection = document.getElementById('gemini-section');
        const geminiBtn = document.getElementById('gemini-btn');
        const geminiLoading = document.getElementById('gemini-loading');
        const geminiResult = document.getElementById('gemini-result');
        
        // Buttons
        const incenseBtn = document.getElementById('incense-btn');
        const offeringBtn = document.getElementById('offering-btn');
        const prayBtn = document.getElementById('pray-btn');
        const submitPrayerBtn = document.getElementById('submit-prayer-btn');
        const castBlocksBtn = document.getElementById('cast-blocks-btn');
        const drawFortuneBtn = document.getElementById('draw-fortune-btn');
        const resetBtn = document.getElementById('reset-btn');

        // éˆç±¤è³‡æ–™
        const fortunes = [
            { title: "å¤§å‰", text: "é›²é–‹æœˆå‡ºè¦‹åˆ†æ˜ï¼Œä¸é ˆé€²é€€å•å‰ç¨‹ï¼Œå©šå§»çš†ç”±å¤©è¨»å®šï¼Œå’Œåˆæ¸…å‰è¬äº‹æˆã€‚" },
            { title: "ä¸­å‰", text: "èˆŠæ¨é‡é‡æœªæ”¹ç‚ºï¼Œå®¶ä¸­ç¦æ‚£ä¸è‡¨èº«ï¼Œé ˆç•¶è¬¹é˜²å®œä½œç¦ï¼Œé¾è›‡äº¤æœƒå¾—å’Œåˆã€‚" },
            { title: "å°å‰", text: "ä¸€ç´™å®˜æ›¸ç«æ€¥å‚¬ï¼Œæ‰èˆŸé€Ÿä¸‹æµªå¦‚é›·ï¼Œé›–ç„¶ç›®ä¸‹å¤šé©šéšªï¼Œä¿æ±å¹³å®‰å»å¾©å›ã€‚" },
            { title: "å¹³", text: "å‹å¿ƒè²»åŠ›æ¬²æˆåŠŸï¼Œå¾…å¾—èŠ±é–‹ä¸€é™£é¢¨ï¼Œå¤šè¬æ±é¢¨è¼•å€ŸåŠ›ï¼Œæœ›æ±åˆ¥æœ‰ä¸€æç´…ã€‚" },
            { title: "å‡¶", text: "é¢¨é›²è‡´é›¨è½æ´‹æ´‹ï¼Œå¤©ç½æ™‚æ°£å¿…æœ‰å‚·ï¼Œç¦³ç¦±å­ç¦³ç¥ä¿ä½‘ï¼Œé—”å®¶å¤§å°å®šå®‰åº·ã€‚" }
        ];

        let hasOfferedFruits = false;
        let hasOfferedFlowers = false;

        function updateMessage(msg, duration = 2000) {
            messageBoard.textContent = msg;
        }

        async function callGeminiAPI(prayer, fortuneTitle, fortuneText) {
            const apiKey = ""; // Leave this as-is
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            const systemPrompt = "æ‚¨æ˜¯ä¸€ä½æ…ˆæ‚²ç‚ºæ‡·ã€å……æ»¿æ™ºæ…§çš„è§€éŸ³è©è–©ã€‚è«‹ç”¨æº«å’Œã€é¼“å‹µä¸”å¯Œæœ‰ç¦ªæ„çš„èªæ°£ï¼Œç‚ºä¿¡çœ¾è§£èªªç±¤è©©çš„æ·±å±¤å«ç¾©ã€‚æ‚¨çš„è§£ææ‡‰çµåˆä¿¡çœ¾çš„ç¥ˆé¡˜å…§å®¹ï¼Œçµ¦äºˆä»–å€‘æ–¹å‘å’Œå¿ƒéˆçš„æ…°è—‰ï¼Œè€Œéç›´æ¥çµ¦äºˆçµ•å°çš„æ˜¯éç­”æ¡ˆã€‚è«‹ä»¥ã€å–„ä¿¡ï¼Œä½ æ‰€æ±‚ä¹‹äº‹...ã€é–‹é ­ã€‚";
            const userQuery = `ä¿¡çœ¾çš„ç¥ˆé¡˜æ˜¯ï¼šã€Œ${prayer}ã€ã€‚æŠ½åˆ°çš„ç±¤è©©æ˜¯ã€Œ${fortuneTitle} - ${fortuneText}ã€ã€‚è«‹åŸºæ–¼æ­¤ç¥ˆé¡˜ï¼Œç‚ºä¿¡çœ¾é–‹ç¤ºé€™æ”¯ç±¤çš„æ„ç¾©ã€‚`;
            
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                const candidate = result.candidates?.[0];

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    return candidate.content.parts[0].text;
                } else {
                    return "è§€éŸ³è©è–©ä»Šæ—¥ç¨ä½œæ­‡æ¯ï¼Œè«‹éœå¿ƒé«”æœƒç±¤è©©åŸæ„ã€‚";
                }
            } catch (error) {
                console.error("Gemini API call failed:", error);
                return "èˆ‡è§€éŸ³è©è–©çš„é€£çµä¼¼ä¹æœ‰äº›ä¸ç©©å®šï¼Œè«‹ç¨å¾Œå†è©¦ã€‚";
            }
        }
        
        // 1. ä¸Šé¦™
        incenseBtn.addEventListener('click', () => {
            incense.classList.add('visible');
            updateMessage('æ‚¨å·²ä¸Šé¦™ï¼Œè«‹ç»ä¸Šä¾›å“ã€‚');
            incenseBtn.disabled = true;
            offeringBtn.disabled = false;
        });

        // 2. ç»ä¾›
        offeringBtn.addEventListener('click', () => {
            if (!hasOfferedFruits) {
                fruits.classList.add('visible');
                hasOfferedFruits = true;
                updateMessage('ç»ä¸Šæ°´æœã€‚è«‹ç¹¼çºŒç»ä¸Šé®®èŠ±ã€‚');
            } else if (!hasOfferedFlowers) {
                flowers.classList.add('visible');
                hasOfferedFlowers = true;
                updateMessage('ä¾›å“å·²ç»é½Šï¼Œè«‹èª å¿ƒç¥ˆç¦ã€‚');
                offeringBtn.disabled = true;
                prayBtn.disabled = false;
            }
        });

        // 3. ç¥ˆç¦
        prayBtn.addEventListener('click', () => {
            prayerSection.classList.remove('hidden');
            prayerSection.classList.add('flex');
            updateMessage('è«‹åœ¨ä¸‹æ–¹è¼¸å…¥æ‚¨çš„ç¥ˆé¡˜ã€‚');
            prayBtn.disabled = true;
        });

        submitPrayerBtn.addEventListener('click', () => {
            prayerSection.classList.add('hidden');
            prayerSection.classList.remove('flex');
            if (prayerText.value.trim() === '') {
                 updateMessage('æ‚¨çš„ç¥ˆé¡˜å·²é»˜å¿µå¿ƒä¸­ï¼Œè«‹æ“²ç­Šå•äº‹ã€‚');
            } else {
                 updateMessage('ç¥æ˜å·²è½è¦‹æ‚¨çš„ç¥ˆé¡˜ï¼Œè«‹æ“²ç­Šå•äº‹ã€‚');
            }
            castBlocksBtn.disabled = false;
        });

        // 4. æ“²ç­Š
        castBlocksBtn.addEventListener('click', () => {
            fortuneSlip.classList.add('hidden');
            geminiSection.classList.add('hidden');
            geminiResult.style.display = 'none';
            const result = Math.floor(Math.random() * 3);
            drawFortuneBtn.disabled = true; 
            
            setTimeout(() => {
                if (result === 0) { // è–ç­Š
                    jiaobeiResult.textContent = 'ğŸŒ•ğŸŒ‘ è–ç­Š - ç¥æ˜åŒæ„äº†æ‚¨çš„è«‹æ±‚ã€‚';
                    jiaobeiResult.style.color = '#4ade80';
                    updateMessage('ç²å¾—è–ç­Šï¼Œæ‚¨å¯ä»¥æ±‚å–éˆç±¤ã€‚');
                    drawFortuneBtn.disabled = false;
                } else if (result === 1) { // ç¬‘ç­Š
                    jiaobeiResult.textContent = 'ğŸŒ•ğŸŒ• ç¬‘ç­Š - ç¥æ˜åœ¨ç¬‘ã€‚';
                    jiaobeiResult.style.color = '#facc15';
                    updateMessage('å•é¡Œä¸æ˜ç¢ºæˆ–æ™‚æ©Ÿæœªåˆ°ï¼Œè«‹é‡æ–°æ•´ç†å¿ƒæƒ…å†å•ä¸€æ¬¡ã€‚');
                } else { // é™°ç­Š
                    jiaobeiResult.textContent = 'ğŸŒ‘ğŸŒ‘ é™°ç­Š - ç¥æ˜ä¸åŒæ„ã€‚';
                    jiaobeiResult.style.color = '#f87171';
                    updateMessage('æ­¤äº‹ä¸å¯è¡Œï¼Œè«‹å‹¿å¼·æ±‚ã€‚');
                }
            }, 500);
            
            jiaobeiResult.textContent = 'æ“²ç­Šä¸­...';
        });

        // 5. æ±‚ç±¤
        drawFortuneBtn.addEventListener('click', () => {
            const randomFortune = fortunes[Math.floor(Math.random() * fortunes.length)];
            fortuneTitle.textContent = `ã€${randomFortune.title}ã€‘`;
            fortuneText.textContent = randomFortune.text;
            
            fortuneSlip.classList.remove('hidden');
            geminiSection.classList.remove('hidden');
            geminiBtn.style.display = 'block';
            geminiResult.style.display = 'none';
            geminiResult.textContent = '';
            
            updateMessage('æ‚¨ç²å¾—äº†éˆç±¤ï¼Œå¯è«‹è§€éŸ³é–‹ç¤ºã€‚');
            drawFortuneBtn.disabled = true;
        });

        // âœ¨ Gemini API è§£ç±¤
        geminiBtn.addEventListener('click', async () => {
            geminiBtn.style.display = 'none';
            geminiLoading.classList.remove('hidden');
            
            const userPrayer = prayerText.value.trim() === '' ? 'ä¿¡çœ¾æœªå¡«å¯«ç¥ˆé¡˜ï¼Œåªæ±‚å¿ƒä¸­æŒ‡å¼•' : prayerText.value;
            const fTitle = fortuneTitle.textContent;
            const fText = fortuneText.textContent;
            
            const interpretation = await callGeminiAPI(userPrayer, fTitle, fText);
            
            geminiResult.textContent = interpretation;
            geminiLoading.classList.add('hidden');
            geminiResult.style.display = 'block';
        });
        
        // é‡è¨­
        resetBtn.addEventListener('click', () => {
            incense.classList.remove('visible');
            fruits.classList.remove('visible');
            flowers.classList.remove('visible');
            prayerSection.classList.add('hidden');
            prayerSection.classList.remove('flex');
            fortuneSlip.classList.add('hidden');
            geminiSection.classList.add('hidden');
            
            incenseBtn.disabled = false;
            offeringBtn.disabled = true;
            prayBtn.disabled = true;
            castBlocksBtn.disabled = true;
            drawFortuneBtn.disabled = true;
            
            prayerText.value = '';
            jiaobeiResult.textContent = '';
            hasOfferedFruits = false;
            hasOfferedFlowers = false;

            updateMessage('è«‹é»æ“Šã€Œä¸Šé¦™ã€é–‹å§‹æ‚¨çš„åƒæ‹œã€‚');
        });

    </script>
</body>
</html>

